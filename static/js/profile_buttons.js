// Generated by CoffeeScript 1.4.0
(function() {
  var pluralPersonWord, wordToGenitiveCase;

  if (typeof String.prototype.endsWith !== "function") {
    String.prototype.endsWith = function(suffix) {
      return this.indexOf(suffix, this.length - suffix.length) !== -1;
    };
  }

  wordToGenitiveCase = function(word) {
    return "" + word + "\'" + (!word.endsWith('s') ? 's' : void 0);
  };

  pluralPersonWord = function(count) {
    if (count === 1) {
      return "person";
    } else {
      return "people";
    }
  };

  $(document).ready(function() {
    var $aboutMore, $aboutMoreButton, $aboutMoreUl, $followButton, aboutSlideTime, aboutSliding, aboutVisible, clickedFollowButton, setAboutMoreVisible, updateFollowerCountLabel;
    $aboutMoreButton = $("#profile-about-more-button");
    $aboutMore = $("#profile-about-more");
    $aboutMoreUl = $aboutMore.children("ul");
    updateFollowerCountLabel = function() {
      $.ajax({
        type: "get",
        url: "/api/get-follower-count/" + viewingUsername + "/"
      }).done(function(data) {
        var followerCount;
        followerCount = parseInt(data);
        return $aboutMore.find("#profile-about-follower-count").text("Followed by " + followerCount + " " + (pluralPersonWord(followerCount)));
      });
      return $.ajax({
        type: "get",
        url: "/api/get-followed-count/" + viewingUsername + "/"
      }).done(function(data) {
        var followedCount;
        followedCount = parseInt(data);
        return $aboutMore.find("#profile-about-followed-count").text("Follows " + followedCount + " " + (pluralPersonWord(followedCount)));
      });
    };
    aboutSlideTime = 150;
    aboutVisible = false;
    aboutSliding = false;
    setAboutMoreVisible = function(visible, instant) {
      var time;
      if (instant == null) {
        instant = false;
      }
      if (aboutSliding) {
        return;
      }
      if (visible) {
        updateFollowerCountLabel();
      }
      aboutVisible = visible;
      aboutSliding = true;
      time = instant ? 0 : aboutSlideTime;
      if (aboutVisible) {
        $aboutMoreUl.slideDown(time, function() {
          return aboutSliding = false;
        });
        return $aboutMoreButton.text("Close");
      } else {
        $aboutMoreUl.slideUp(time, function() {
          return aboutSliding = false;
        });
        return $aboutMoreButton.text("About");
      }
    };
    $aboutMoreButton.click(function() {
      return setAboutMoreVisible(!aboutVisible);
    });
    setAboutMoreVisible(false, true);
    $followButton = $("#profile-follow-button");
    clickedFollowButton = false;
    return $followButton.click(function() {
      if (clickedFollowButton) {
        return;
      }
      clickedFollowButton = true;
      return $.ajax({
        type: "POST",
        url: "/api/toggle-follows/",
        data: {
          followUser: viewingUsername
        }
      }).done(function(data) {
        if (data.toLowerCase() === "true") {
          $followButton.addClass("profile-follow-button-followed");
          $followButton.text("Followed!");
        } else {
          $followButton.removeClass("profile-follow-button-followed");
          $followButton.text("Follow");
        }
        updateFollowerCountLabel();
        return clickedFollowButton = false;
      });
    });
  });

}).call(this);
